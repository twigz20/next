define("MoveUtils",["require","exports","module"],function(e,t,n){"use strict";function r(e,t){var n=new $.Deferred,r=o.fs();e=e.replace(/\/?$/,""),t=t.replace(/\/?$/,"");var l=a.basename(e);return e===t||a.dirname(e)===t||0===t.indexOf(e)?n.resolve():(r.readdir(t,function(o,a){return o?n.reject(o):-1!==a.indexOf(l)?n.reject({type:s}):void r.mv(e,t,function(o){return o?n.reject(o):void r.rm(e,{recursive:!0},function(e){return e?n.reject(e):void i.refresh(function(e){return e?n.reject(e):void n.resolve(t)})})})}),n)}var o=brackets.getModule("filesystem/impls/filer/BracketsFiler"),i=brackets.getModule("filesystem/impls/filer/FileSystemCache"),a=o.Path,s="needs rename";t.move=r,t.NEEDS_RENAME=s}),define("text",["module"],function(e){"use strict";var t,n,r,o,i,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d="undefined"!=typeof location&&location.href,c=d&&location.protocol&&location.protocol.replace(/\:/,""),u=d&&location.hostname,f=d&&(location.port||void 0),m={},v=e.config&&e.config()||{};return t={version:"2.0.10",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=a[t];try{e=new ActiveXObject(n)}catch(r){}if(e){a=[n];break}}return e},parseName:function(e){var t,n,r,o=!1,i=e.indexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return-1!==i&&(!a||i>1)?(t=e.substring(0,i),n=e.substring(i+1,e.length)):t=e,r=n||t,i=r.indexOf("!"),-1!==i&&(o="strip"===r.substring(i+1),r=r.substring(0,i),n?n=r:t=r),{moduleName:t,ext:n,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,o){var i,a,s,l=t.xdRegExp.exec(e);return l?(i=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(i&&i!==n||a&&a.toLowerCase()!==r.toLowerCase()||(s||a)&&s!==o)):!0},finishLoad:function(e,n,r,o){r=n?t.strip(r):r,v.isBuild&&(m[e]=r),o(r)},load:function(e,n,r,o){if(o.isBuild&&!o.inlineText)return void r();v.isBuild=o.isBuild;var i=t.parseName(e),a=i.moduleName+(i.ext?"."+i.ext:""),s=n.toUrl(a),l=v.useXhr||t.useXhr;return 0===s.indexOf("empty:")?void r():void(!d||l(s,c,u,f)?t.get(s,function(n){t.finishLoad(e,i.strip,n,r)},function(e){r.error&&r.error(e)}):n([a],function(e){t.finishLoad(i.moduleName+"."+i.ext,i.strip,e,r)}))},write:function(e,n,r,o){if(m.hasOwnProperty(n)){var i=t.jsEscape(m[n]);r.asModule(e+"!"+n,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,n,r,o,i){var a=t.parseName(n),s=a.ext?"."+a.ext:"",l=a.moduleName+s,d=r.toUrl(a.moduleName+s)+".js";t.load(l,r,function(n){var r=function(e){return o(d,e)};r.asModule=function(e,t){return o.asModule(e,d,t)},t.write(e,l,r,i)},i)}},"node"===v.env||!v.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var o=n.readFileSync(e,"utf8");0===o.indexOf("\ufeff")&&(o=o.substring(1)),t(o)}catch(i){r(i)}}):"xhr"===v.env||!v.env&&t.createXhr()?t.get=function(e,n,r,o){var i,a=t.createXhr();if(a.open("GET",e,!0),o)for(i in o)o.hasOwnProperty(i)&&a.setRequestHeader(i.toLowerCase(),o[i]);v.onXhr&&v.onXhr(a,e),a.onreadystatechange=function(t){var o,i;4===a.readyState&&(o=a.status,o>399&&600>o?(i=new Error(e+" HTTP status: "+o),i.xhr=a,r(i)):n(a.responseText),v.onXhrComplete&&v.onXhrComplete(a,e))},a.send(null)}:"rhino"===v.env||!v.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,r,o="utf-8",i=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),o)),l="";try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),null!==r&&n.append(r);null!==(r=s.readLine());)n.append(a),n.append(r);l=String(n.toString())}finally{s.close()}t(l)}:("xpconnect"===v.env||!v.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(r=Components.classes,o=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),i="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,a,s,l={};i&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),n.init(s,1,0,!1),a=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),a.init(n,"utf-8",n.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(n.available(),l),a.close(),n.close(),t(l.value)}catch(d){throw new Error((s&&s.path||"")+": "+d)}}),t}),define("text!htmlContent/move-to-dialog.html",[],function(){return'<div class="move-to-dialog modal">\n    <div class="modal-header">\n        <h1 class="dialog-title">{{ PICK_A_FOLDER_TO_MOVE_TO }}</h1>\n    </div>\n\n    <div class="modal-body">\n        <div class="directories"\n             data-destination="{{defaultPath}}"\n             data-source="{{source}}">\n            {{> directories}}\n        </div>\n    </div>\n\n    <div class="modal-footer">\n        <button class="dialog-button btn" data-button-id="cancel">{{ CANCEL }}</button>\n        <button class="dialog-button btn primary" data-button-id="ok">{{ OK }}</button>\n    </div>\n</div>\n'}),define("text!htmlContent/directory-tree.html",[],function(){return'<div {{#indent}} style="margin-left: {{indent}}px;" {{/indent}}>\n    {{#.}}\n        <div class="directory" data-path="{{path}}">\n            <div class="directory-name {{#defaultPath}}active-directory{{/defaultPath}}">\n                {{^noIcon}}<span class="folder-icon"></span>{{/noIcon}}\n                <span><strong>{{name}}</strong></span>\n            </div>\n            {{#children}}\n                {{> subdirectories}}\n            {{/children}}\n        </div>\n    {{/.}}\n</div>\n'}),define("MoveToDialog",["require","exports","module","MoveUtils","text!htmlContent/move-to-dialog.html","text!htmlContent/directory-tree.html"],function(e,t,n){"use strict";function r(e,t,n){function r(){M.off("change",r),u.showInTree(M.getFileForPath(i)),p.reload()}var o,i,a=v.getCurrentlyViewedPath();return n&&(o=E.relative(E.dirname(e),a),""===o&&(o=E.basename(a)),i=E.join(t,o),0===a.indexOf(e))?(f.execute(m.CMD_OPEN,{fullPath:i}),M.on("change",r),void u.refreshFileTree()):(u.refreshFileTree(),void p.reload())}function o(e,t,n){var r=E.basename(e),o=E.basename(t);return n.type===_.NEEDS_RENAME?void d.showModalDialog(c.DIALOG_ID_ERROR,y.ERROR_MOVING_FILE_DIALOG_HEADER,C.format(y.ERROR_MOVING_FILE_SAME_NAME,r,o)):(d.showModalDialog(c.DIALOG_ID_ERROR,y.ERROR_MOVING_FILE_DIALOG_HEADER,C.format(y.ERROR_MOVING_FILE,r,o)),void console.error("[Bramble] Failed to move `",e,"` to `",t,"` with: ",n))}function i(e){$(window.document.body).one("keyup.installDialog",function(t){t.keyCode===g.DOM_VK_ESCAPE&&e.close()}),e.getElement().one("buttonClick",function(t,n){if(n===d.DIALOG_BTN_CANCEL)return e.close();if(n===d.DIALOG_BTN_OK){var i=$(".move-to-dialog .directories"),a=i.attr("data-source"),s=i.attr("data-destination");_.move(a,s).done(r.bind(null,a,s)).fail(o.bind(null,a,s)).always(function(){e.close()})}})}function a(e){var t=$(".move-to-dialog .directories");$(".move-to-dialog .directory-name").mousedown(function(e){$(e.currentTarget).addClass("active-directory")}).click(function(e){var n=$(e.currentTarget);$(".move-to-dialog .directory-name").removeClass("active-directory"),t.attr("data-destination",n.parent().attr("data-path")),n.addClass("active-directory")})}function s(e,t){function n(t,r,i){if("DIRECTORY"!==r.type)return t;var s=E.join(o,r.path),l={name:r.path,path:s,children:!1,indent:a,defaultPath:s===e};return r.contents&&r.contents.length>0&&(a+=w,o=s,l.children=r.contents.reduce(n,!1),o=E.dirname(s),a-=w),t=t||[],t.push(l),t}var r=h.project("root"),o=r.replace(/\/?$/,""),i=[{path:o,name:y.PROJECT_ROOT,children:!1,indent:0,noIcon:!0,defaultPath:o===e}],a=0;b.fs().ls(r,{recursive:!0},function(e,r){return e?t(e):void t(null,r.reduce(n,i))})}function l(){var e=u.getContext();if(e){var t=E.dirname(e.fullPath);s(t,function(n,r){if(n)return console.error("Failed to get list of directories with: ",n);var o={defaultPath:t,source:e.fullPath,PICK_A_FOLDER_TO_MOVE_TO:y.PICK_A_FOLDER_TO_MOVE_TO,OK:y.OK,CANCEL:y.CANCEL},s={subdirectories:R},l={directories:O.render(R,r,s)},c=O.render(x,o,l),u=d.showModalDialogUsingTemplate(c,!1);i(u),a(e.fullPath)})}}var d=brackets.getModule("widgets/Dialogs"),c=brackets.getModule("widgets/DefaultDialogs"),u=brackets.getModule("project/ProjectManager"),f=brackets.getModule("command/CommandManager"),m=brackets.getModule("command/Commands"),v=brackets.getModule("view/MainViewManager"),p=brackets.getModule("LiveDevelopment/LiveDevMultiBrowser"),g=brackets.getModule("utils/KeyEvent"),h=brackets.getModule("bramble/StartupState"),M=brackets.getModule("filesystem/FileSystem"),b=brackets.getModule("filesystem/impls/filer/BracketsFiler"),E=b.Path,y=brackets.getModule("strings"),C=brackets.getModule("utils/StringUtils"),O=brackets.getModule("thirdparty/mustache/mustache"),_=e("MoveUtils"),x=e("text!htmlContent/move-to-dialog.html"),R=e("text!htmlContent/directory-tree.html"),w=20;O.parse(x),O.parse(R),t.open=l}),define("main",["require","exports","module","MoveToDialog"],function(e,t,n){"use strict";var r=brackets.getModule("command/CommandManager"),o=brackets.getModule("command/Commands"),i=brackets.getModule("command/Menus"),a=brackets.getModule("utils/ExtensionUtils"),s=brackets.getModule("strings"),l=e("MoveToDialog"),d="bramble-move-file.moveFile";r.register(s.CMD_MOVE_FILE,d,l.open);var c=i.getContextMenu(i.ContextMenuIds.PROJECT_MENU);c.addMenuItem(d,null,i.AFTER,o.FILE_RENAME),a.loadStyleSheet(n,"styles/style.less")});